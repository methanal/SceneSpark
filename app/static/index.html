<!DOCTYPE html>
<html>
<head>
    <title>视频上传与处理</title>
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <style>
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
        .section {
            margin: 10px;
            width: 80%;
        }
        #videoPreview {
            display: none;
            max-width: 100%;  /* 限制视频最大宽度 */
            max-height: 500px; /* 限制视频最大高度 */
        }
        video {
            max-width: 100%;  /* 限制视频最大宽度 */
            max-height: 500px; /* 限制视频最大高度 */
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="section">
            <label for="fileInput">选择视频文件（多选）：</label>
            <input type="file" id="fileInput" multiple>
        </div>
        <div class="section">
            <label for="textInput">文本编辑区：</label>
            <textarea id="textInput" rows="4" cols="50"></textarea>
        </div>
        <div class="section">
            <button id="uploadButton" onclick="uploadFiles()">上传</button>
            <button id="extractButton" onclick="extractContent()">抽取</button>
            <button id="viewResultButton" onclick="viewResult()">查看结果</button>
        </div>
        <div class="section" id="videoContainer"></div>
    </div>

    <script>
        let requestId = null;

        async function uploadFiles() {
            const files = document.getElementById('fileInput').files;
            const text = document.getElementById('textInput').value;
            if (files.length === 0 || !text) {
                alert('请先选择视频文件并填写文本内容');
                return;
            }

            const formData = new FormData();
            for (const file of files) {
                formData.append('files', file);
            }
            formData.append('text', text);

            const response = await fetch('/api/v1/upload', {
                method: 'POST',
                body: formData
            });

            if (response.ok) {
                const result = await response.json();
                requestId = result.request_id;
                alert(`Files uploaded successfully. Request ID: ${requestId}`);
            } else {
                alert('上传失败');
            }
        }

        async function extractContent() {
            if (!requestId) {
                alert('请先上传文件');
                return;
            }

            const response = await fetch(`/api/v1/extract/${requestId}`);
            if (!response.ok) {
                alert('抽取失败，请重试');
                return;
            }

            alert('内容抽取成功，请查看结果');
        }

        async function viewResult() {
            if (!requestId) {
                alert('请先上传并抽取内容');
                return;
            }

            const videoUrl = `/static/videos/${requestId}/cut.mp4`;
            const videoContainer = document.getElementById('videoContainer');

            videoContainer.innerHTML = `
                <video controls autoplay name="media" style="display: block;">
                    <source src="${videoUrl}" type="video/mp4">
                </video>
            `;
        }
    </script>
</body>
</html>
